<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:include="/common/common :: head(~{::title},~{::link},~{::script})">
    <title>LDCT检查信息</title>
    <link>
</head>
<body>

<!--/*@thymesVar id="#dic" type="com.wonders.health.tumor.common.tags.DictData"*/-->
<div class="content pd-10" style="width:auto; overflow: hidden;">
    <div class="title_tip mt-30">基本信息</div>
    <table class="table_new mt-10" id="baseForm">
        <tbody>
        <tr>
            <th width="10%">姓&nbsp;&nbsp;名</th>
            <td width="20%">
                <span th:text="${personInfo.name}"></span>
            </td>
            <th width="10%">性&nbsp;&nbsp;别</th>
            <td width="20%">
                <span th:text="${#dic.generalName('60023', personInfo.gender)}"></span>
            </td>
            <th width="10%">身份证号码</th>
            <td>
                <span th:text="${personInfo.personcard}"></span>
            </td>
        </tr>
        <tr>
            <th width="10%">出生日期</th>
            <td>
                <span th:text="${#dates.format(personInfo.birth, 'yyyy-MM-dd')}"></span>
            </td>
            <th width="10%">固定电话</th>
            <td width="20%">
                <span th:text="${personInfo.telephone}"></span>
            </td>
            <th width="10%">移动电话</th>
            <td width="20%">
                <span th:text="${personInfo.mobile}"></span>
            </td>
        </tr>
        <tr>
            <th width="10%">居住地址</th>
            <td colspan="5" class="bg-white" style="padding:0px;">
                <span th:text="${personInfo.addressDetail}"></span>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="title_tip mt-30">低密度螺旋CT检查信息</div>
    <table class="table_new mt-10">
        <tbody>
        <tr>
            <th width="10%">检查日期</th>
            <td width="20%">
                <span th:text="${#dates.format(ldctCheck.ldctCheckDate, 'yyyy-MM-dd')}"></span>
            </td>
            <th width="10%">检查医生</th>
            <td width="20%">
                <span th:text="${ldctCheck.ldctCheckDoctor}"></span>
            </td>
            <th width="10%">检查医疗机构</th>
            <td>
                <span th:text="${ldctApp.appointmentOrg}"></span>
            </td>
        </tr>
        <tr>
            <th width="10%">检查结果</th>
            <td>
                <span th:text="${#dic.generalName('60001', ldctCheck.ldctResultType)}"></span>
            </td>
            <th width="10%">随访建议</th>
            <td width="20%" colspan="2">
                <span th:text="${#dic.generalName('60061', ldctCheck.ldctResult)}"></span>
            </td>
            <td width="20%" class="bg-white">
                <button class="my-btn my-btn-blue mr-20" onclick="">查看360影像</button>
            </td>
        </tr>
        <tr>
            <th width="10%">检查信息描述</th>
            <td colspan="5" class="bg-white" style="padding:0px;">
                <span th:text="${ldctCheck.ldctMiaoshu}"></span>
            </td>
        </tr>
        </tbody>
    </table>
    <div class="btn-list text-c mt-30">
        <button class="my-btn my-btn-blue mr-20"
                th:onclick="'javascript:closeWindow( \''+${personInfo.id}+'\')'">返回
        </button>
        <button class="my-btn my-btn-blue mr-20" onclick="reserve()">预约专病</button>
    </div>
    <input id="manageId" class="mini-hidden"/>
</div>

<!-- 预约小窗口 -->
<div id="yy-window" class="mini-window" title="预约" style="width:1000px; height:700px;" showModal="true" allowResize="false" allowDrag="false">
    <iframe width="980" height="620" id="frame1"></iframe>
</div>
</body>
<script type="text/javascript" th:inline="javascript">
    mini.parse();

    var messenger = new Messenger('parent', 'tumor');
    var iframe  = document.getElementById('frame1');
    messenger.addTarget(iframe.contentWindow, 'addMzyy');

    messenger.listen(function (msg) {
        var tbs=JSON.parse(msg);
        console.log(tbs);
        if(tbs.ok==true){

            var yyxh = tbs.yyxh;
            var ksdm = tbs.ksdm;
            var ksmc = tbs.ksmc;
            var ysdm = tbs.ysdm;
            var ysmc = tbs.ysmc;
            var yyrq = tbs.yyrq;
            var yyhx = tbs.yyhx;
            var time = tbs.time;

            var manageId = mini.get("manageId").getValue();
            //alert(yyxh+ "," + ksdm + "," + ksmc+ "," +ysdm+ "," +ysmc+ "," +yyrq+ "," +time+ "," +yyhx);
            //insertCheckRecord(manageId,yyxh,ksdm,ksmc,ysdm,ysmc,yyrq,time,yyhx);

        }
        mini.get("yy-window").hide();
    });

    function closeWindow(manageId) {
        window.location.href = "../../managementObject/detail/?manageId=" + manageId;
    }

    //预约专病
    function reserve() {
        var ip = [[${ip}]];
        var patid = [[${personInfo.patid}]];
        var id = [[${personInfo.id}]];
        if (ip == "http://10.1.93.110") {
            ip = "http://192.168.30.117";
        } else {
            ip = ip.substring(0, ip.lastIndexOf(":"));
        }

        mini.get("manageId").setValue(id);

        var url = ip + ':8071/xkyy/queryZbDoctor.action?patid='+patid;
        $("#frame1").attr("src", url);
        mini.get("yy-window").show();
    }

    //插入预约表
    function insertCheckRecord(manageId,yyxh,ksdm,ksmc,ysdm,ysmc,yyrq,time,yyhx) {
        $.ajax({
            url : "../cancerPersonInfo/insertAppCheck",
            data:{manageId:manageId, yyxh:yyxh, ksdm:ksdm, ksmc:ksmc, ysdm:ysdm,ysmc:ysmc, yyrq:yyrq,time:time,yyhx:yyhx},
            dataType: "json",
            success : function(res) {
                if (res.ok) {
                    mini.showTips({
                        content: res.msg,
                        state: "success",
                        x: "center",
                        y: "center",
                        timeout: 2000
                    });

                } else {
                    mini.showTips({
                        content: res.msg,
                        state: "warning",
                        x: "center",
                        y: "center",
                        timeout: 2000
                    });
                }
            }
        });
    }
</script>
</html>