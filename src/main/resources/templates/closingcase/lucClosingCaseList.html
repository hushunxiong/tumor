<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:include="/common/common :: head(~{::title},~{::link},~{::script})">
    <title>肺癌结案一览</title>
    <link>
    <script></script>
</head>
<body>

<div class="content pd-10" style="width:auto; overflow: hidden;">
    <div class="mini-tabs" activeIndex="0" style=" width:100%; overflow: hidden;">
        <div title="肺癌结案一览">
            <!--/*@thymesVar id="#dic" type="com.wonders.health.tumor.common.tags.DictData"*/-->
            <!--/*@thymesVar id="#auth" type="com.wonders.health.tumor.common.tags.AuthData"*/-->
            <div class="search-div-box mb-10">
                <table width="99%" border="0">
                    <tbody>
                    <tr>
                        <td align="left">
                            <div class="keyword">
                                <input id="keyword" name="keyword" class="radius" placeholder="可按照姓名或者证件号码模糊查询" data-tooltip="输入证件号码时至少6位" type="text">
                                <div class="my-btn my-btn-blue" onclick="onSearch()">搜索</div>
                            </div>
                        </td>
                        <td width="100px" align="center">
                            <a herf="#" onclick="toggleVisibility(div1)"><strong style="color:#3f93d4">高级搜索&nbsp;<img
                                    th:src="@{/images/pp_up.png}" src="../static/images/pp_up.png" id="pctid"></strong></a></td>
                        <td align="left"></td>
                        <td style="width: 200px" align="right">

                        </td>
                    </tr>
                    </tbody>
                </table>
                <div id="div1" style=" display: none;" class="mt-10">
                    <div class="mini-row">
                        <div class="mini-col-3"><label class="mr-5">初筛年份：</label>
                            <select id="csnf" name="csnf" class="select-default radius" style="width:42%">
                                <option value="">请选择</option>
                                <option th:each="row,loop : ${csnf}" th:value="${row}" th:text="${row}"  th:selected="${loop.index eq 0 ? true:false}"></option>
                            </select>
                        </div>
                        <div class="mini-col-3">
                            <label class="mr-5">登记机构所属区：</label>
                            <input id="regarea" name="regarea" showNullItem="true" class="mini-combobox" width="46%"
                                   th:data="${#auth.getAreas(areaCode)}"
                                   emptyText="请选择"    textField="text" valueField="id" onvaluechanged="getHospitals()" th:value="${role =='sjk' ? '':areaCode}"  th:showNullItem="${role =='sjk' ? true:false}"  th:disabled="${role =='sjk' ? false:true}"/>
                        </div>
                        <div class="mini-col-3">
                            <label class="mr-5">登记机构：</label>

                            <input id="regorg" name="regorg"  class="mini-combobox" width="66%"
                                   emptyText="请选择"  textField="text" valueField="id" th:value="${role =='bsq' ? #auth.currUser().orgCode:''}"  th:showNullItem="${role =='bsq' ? false:true}" th:disabled="${role =='bsq' ? true:false}" />
                        </div>

                    </div>

                    <div class="mini-row">
                        <div class="mini-col-3">
                            <label class="mr-5">初筛编号：</label>
                            <input  emptyText="请输入" id="idNumber" name="idNumber" type="text" class="mini-textbox" width="42%">
                        </div>
                        <div class="mini-col-3">
                             <label class="mr-5">肺癌初筛判定结果：</label>
                            <input id="checkResult" name="checkResult"  showNullItem="true" class="mini-combobox" width="42%"
                                   emptyText="请选择" textField="name" valueField="code"  th:data="${#dic.generals('60053')}"/>
                        </div>
                        <div class="mini-col-3">
                            <label class="mr-5">肺癌结案结果：</label>
                            <input id="closeResult" name="closeResult"  showNullItem="true" class="mini-combobox" width="49%"
                                   emptyText="请选择" textField="name" valueField="code"  th:data="${#dic.generals('60004')}"/>
                        </div>
                    </div>

                </div>
            </div>

            <div id="datagrid" url="../lucClosingCase/data" class="mini-datagrid" style=" width: 99%;height: auto"
                 sizeList="[10,20,50]" pageSize="20" idField="id">
                <div property="columns">
                    <div field="idNumber" autoShowPopup="true"  width="120px"  headerAlign="center" align="center"  allowSort="true" >初筛ID</div>
                    <div field="checkYear" sortField="checkYear"  autoShowPopup="true"  width="120px"  headerAlign="center" align="center"  allowSort="true" >肺癌初筛年份</div>
                    <div field="name"  width="100px" headerAlign="center" style="min-width:100px; width:auto;" align="center">姓名</div>
                    <div field="personcardType" type="comboboxcolumn" autoShowPopup="true"  width="70px" headerAlign="center" align="center"  allowSort="false" >证件类型
                        <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                               valueField="code" th:data="${#dic.generals('60022')}"/></div>
                    <div field="personcard" sortField="personcard" renderer="sfzhRenderer" width="100px" headerAlign="center" align="center" allowSort="false">证件号码</div>
                    <div field="gender" type="comboboxcolumn" autoShowPopup="true" width="50px" headerAlign="center" align="center" allowSort="false">性别
                        <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                               valueField="code" th:data="${#dic.generals('60023')}"/></div>
                    <div field="assessmentResult" type="comboboxcolumn" autoShowPopup="true" width="150px" headerAlign="center" align="center" allowSort="false" >肺癌危险评估结果
                        <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                               valueField="code" th:data="${#dic.generals('60001')}"/></div>
                    <div field="checkResult" type="comboboxcolumn" autoShowPopup="true"  width="150px" headerAlign="center" align="center"  allowSort="false" >肺癌判定结果
                        <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                               valueField="code" th:data="${#dic.generals('60001')}"/></div>
                    <div field="closeStatus" type="comboboxcolumn" autoShowPopup="true"  width="150px" headerAlign="center" align="center"  allowSort="false" >肺癌结案状态
                        <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                               valueField="code" th:data="${#dic.generals('60003')}"/></div>
                    <div field="closeResult" type="comboboxcolumn" autoShowPopup="true"  width="150px" headerAlign="center" align="center"  allowSort="false" >肺癌结案结果
                        <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                               valueField="code" th:data="${#dic.generals('60004')}"/></div>
                </div>
                </div>

            </div>

        </div>

    </div>
</div>
</body>
<script type="text/javascript" th:inline="javascript">
    mini.parse();
    var grid = mini.get("datagrid");
    var form = new mini.Form('#div1');

    $(function () {
        onSearch();
       getHospitals();
    });

    var ctxStatic ='..';
    function toggleVisibility(div1) {

        if (div1.style.display == 'none'){
            div1.style.display = 'block';
            document.getElementById("pctid").src =ctxStatic+ '/images/pp_down.png';
        } else if (div1.style.display == 'block') {
            div1.style.display = 'none';
            document.getElementById("pctid").src = ctxStatic+'/images/pp_up.png';
        } else {
            div1.style.display = 'block';
            document.getElementById("pctid").src = ctxStatic+'/images/pp_down.png';
        }

    }

    function onSearch() {
        var data = form.getData(true);
        var keyword = $("#keyword").val();
        if (!validateKey(keyword)) {
            return;
        }
        data.keyword=keyword;
        data.csnf= $("#csnf").val();
        grid.load(data, gridLoadSuccess, gridLoadError);
    }


    function validateKey(key) {
        if(key != null && key != undefined && key != '' && key.length < 6){
            var flag = false;
            for(var i = 0 ; i < key.length ; i++){
                var c = key[i];
                if(!((c >= '0' && c <= '9') || c == "x" || c == "X" || c == " ")){
                    flag = true;
                    break;
                }
            }
            if(!flag) {
                mini.showTips({content: "按照证件号码查询，输入不能小于六位", state: "success", x: "center", y: "center", timeout: "2000"});
            }
            return flag;
        }
        return true;
    }

    function getHospitals(){
        var regarea= mini.get("regarea").getValue();
        var url="../dicHospitalInfo/getHospitalsByAreaCode?areaCode="+regarea;
        mini.get("regorg").setUrl(url);
    }

    function sfzhRenderer(e) {
        var r = e.record;
        var personcard = r.personcard;
        if (personcard.length > 6) {
            personcard = personcard.substring(personcard.length - 6);
        }
        return "*" + personcard;
    }

</script>

</html>

