<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:fragment="head(title,links,scripts)">
    <meta charset="UTF-8">
    <!--<title th:replace="${title}">肿瘤早发现</title>-->
    <script src="../static/js/jquery.min.js" th:src="@{/js/jquery.min.js}" type="text/javascript"></script>
    <script src="../static/js/common.js" th:src="@{/js/common.js}" type="text/javascript"></script>

    <script src="../static/lib/miniui/miniui.js" th:src="@{/lib/miniui/miniui.js}" type="text/javascript"></script>
    <link href="../static/lib/miniui/themes/icons.css" th:href="@{/lib/miniui/themes/icons.css}" rel="stylesheet" type="text/css" />
    <link href="../static/lib/miniui/themes/default/miniui.css" th:href="@{/lib/miniui/themes/default/miniui.css}" rel="stylesheet" type="text/css" />

    <link href="../static/css/style.css" th:href="@{/css/style.css}" rel="stylesheet" type="text/css" />
    <link href="../static/css/my-mini.css" th:href="@{/css/my-mini.css}" rel="stylesheet" type="text/css" />

    <!--[if lt IE 9]>
    <script src="../js/html5shiv.min.js" th:src="@{/js/html5shiv.min.js}"></script>
    <script src="../js/respond.js" th:src="@{/js/respond.js}"></script>
    <![endif]-->
    <!--[if lte IE 11]>
    <script type="text/javascript" src="../static/js/flexie.js" th:src="@{/js/flexie.js}"></script>
    <script type="text/javascript" src="../static/js/selectivizr.js" th:src="@{/js/selectivizr.js}"></script>
    <script type="text/javascript" src="../static/js/PIE_IE678.js" th:src="@{/js/PIE_IE678.js}"></script>
    <![endif]-->

    <meta charset="UTF-8">
    <title>诊断信息收集表</title>
</head>
<body>

<div class="content pd-10" style="width:auto; overflow: hidden;">
    <div align="center">诊断信息收集表</div>
    <div class="col-lg-12">

        <div class="mini-clearfix">
            <div class="tab-content">
                <div class="secher">
                    <div id="formsearch" class="row mt-10">
                        <!--/*@thymesVar id="#dic" type="com.wonders.health.tumor.common.tags.DictData"*/-->
                        <!--/*@thymesVar id="#auth" type="com.wonders.health.tumor.common.tags.AuthData"*/-->
                        <div class="mini-col-3">
                            <label class="mr-5">登记机构所属区：</label>
                            <input id="regarea" name="regarea" showNullItem="true" class="mini-combobox" width="46%"
                                   th:data="${#auth.getAreas(areaCode)}"
                                   textField="text" valueField="id" onvaluechanged="getHospitals()" th:value="${role =='sjk' ? '':areaCode}"  th:showNullItem="${role =='sjk' ? true:false}"  th:disabled="${role =='sjk' ? false:true}"/>
                        </div>
                        <div class="mini-col-3">
                            <label class="mr-5">登记机构：</label>

                            <input id="regorg" name="regorg"  class="mini-combobox" width="66%" emptyText="请选择"
                                   textField="text" valueField="id" th:value="${role =='bsq' ? #auth.currUser().orgCode:''}"  th:showNullItem="${role =='bsq' ? false:true}" th:disabled="${role =='bsq' ? true:false}" />
                        </div>
                    </div>

                    <div class="col-sm-4 col-lg-3">日期范围：
                        <input id="csrqStart" name="beginDate" class="mini-datepicker"
                               allowInput="true" th:value="${tjRqStart}"  style="width:115px;"  errorMode="border" onvalidation="dateValidation" >
                        -
                        <input id="csrqEnd" name="endDate" class="mini-datepicker"
                               th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" allowInput="false" style="width:115px;" errorMode="border" onvalidation="dateValidation">
                        <div id="js" class="my-btn my-btn-blue" onclick="onSearch()">检索</div>
                        <div class="my-btn my-btn-blue" onclick="reset()">重置</div>
                    </div>

                    <div class="col-sm-2" align="right">
                        <div class="my-btn my-btn-blue" onclick="exportData()">导出</div>
                    </div>

                </div>
                <div> <div id="datagrid" url="../statistics/informationData" class="mini-datagrid" style=" overflow: auto;width: calc(100vw - 25px);height: auto;display: none;"
                           showpager='false' idField="id">
                    <div property="columns" >
                        <div field="xm" width="100px" headerAlign="center" style="min-width:100px; width:auto;" align="center">姓名</div>
                        <div field="personcardType" type="comboboxcolumn" width="100px" headerAlign="center" align="center" allowSort="false">证件类型
                            <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                                   valueField="code" th:data="${#dic.generals('60022')}"/></div>
                        <div field="personcard" renderer="sfzhRenderer" width="200px" headerAlign="center" align="center" allowSort="false">证件号码</div>
                        <div field="regorg" sortField="regorg"autoShowPopup="true" width="150px" headerAlign="center" align="center" allowSort="false" >筛查登记机构</div>
                        <div field="jcxm" width="150px" headerAlign="center" align="center" allowSort="false">检查项目</div>
                        <div field="zlwz" type="comboboxcolumn" autoShowPopup="true" width="150px" headerAlign="center" align="center" allowSort="false" >病变部位</div>
                        <div field="zldx" width="150px" headerAlign="center" align="center" allowSort="false">肿瘤大小（最大直径）</div>
                        <div field="sfhj" type="comboboxcolumn" autoShowPopup="true" width="150px" headerAlign="center" align="center" allowSort="false" >是否活检
                            <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                                   valueField="code" th:data="${#dic.generals('60031')}"/></div>
                        <div field="hjjg" type="comboboxcolumn" autoShowPopup="true" width="150px" headerAlign="center" align="center" allowSort="false" >活检结果
                            <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                                   valueField="code" th:data="${#dic.generals('60033')}"/></div>
                        <div field="sfbl" type="comboboxcolumn" autoShowPopup="true" width="150px" headerAlign="center" align="center" allowSort="false" >是否病理
                            <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                                   valueField="code" th:data="${#dic.generals('60013')}"/></div>
                        <div field="bllx" width="150px" headerAlign="center" align="center" allowSort="false">病理类型</div>
                        <div field="TNMfq" width="200px" headerAlign="center" align="center" allowSort="false">TNM分期</div>
                        <div field="sfrq" dateFormat="yyyy-MM-dd" width="150px" headerAlign="center" align="center" allowSort="false">随访日期</div>
                    </div>
                </div>
            </div>
            </div>



            <script type="text/javascript">

                mini.parse();
                var form = new mini.Form("#formsearch");
                var grid = mini.get("datagrid");

                $(function () {
                    getHospitals();
                });
                function onSearch() {
                    if(form.isValid() == false){
                        miniErrorLocation();
                        showTips('查询条件不正确','warning');
                        $("datagrid").empty();
                        return;
                    }
                    var data={};
                    data.regarea=mini.get("regarea").getValue();
                    data.regorg=mini.get("regorg").getValue();
                    data.csrqStart=mini.get("csrqStart").getValue();
                    data.csrqEnd=mini.get("csrqEnd").getValue();
                    grid.load(data, gridLoadSuccess, gridLoadError);
                    if (grid==null){
                        $("datagrid").empty();
                        return;
                    }
                }

                $(document).ready(function(){
                    $("#js").click(function(){
                        $("#datagrid").show();
                    });
                });

                function getHospitals(){
                    var regarea= mini.get("regarea").getValue();
                    var url="../dicHospitalInfo/getHospitalsByAreaCode?areaCode="+regarea;
                    mini.get("regorg").setUrl(url);
                }
                function reset(){
                    var textbox= $(".mini-textbox").length;


                    for(var i=0;i<textbox;i++) {
                        var id = $(".mini-textbox")[i].id;
                        if(id!="jbzabh"&&id!="etbm"&&id!='csrq'&&id!='dqzt'){
                            if(mini.get(id)!=null){
                                mini.get(id).setValue('');
                            }
                        }
                    }
                }





                //导出
                function exportData(){

                   var  regarea=mini.get("regarea").getValue();
                   var  regorg=mini.get("regorg").getValue();
                   var  csrqStart=mini.get("csrqStart").getValue();
                   var  csrqEnd=mini.get("csrqEnd").getValue();
                   var param ='?';
                    param += 'regarea='+regarea;
                    param += '&regorg='+regorg;
                   /* param += '&csrqStart='+csrqStart;
                    param += '&csrqEnd='+csrqEnd;*/
                    window.location.href="../statistics/exportInformationData"+param;
                }

            </script>

        </div>

    </div>
</div>
</body>
</html>