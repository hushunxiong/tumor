<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:fragment="head(title,links,scripts)">
    <meta charset="UTF-8">
    <!--<title th:replace="${title}">肿瘤早发现</title>-->
    <script src="../static/js/jquery.min.js" th:src="@{/js/jquery.min.js}" type="text/javascript"></script>
    <script src="../static/js/common.js" th:src="@{/js/common.js}" type="text/javascript"></script>

    <script src="../static/lib/miniui/miniui.js" th:src="@{/lib/miniui/miniui.js}" type="text/javascript"></script>
    <link href="../static/lib/miniui/themes/icons.css" th:href="@{/lib/miniui/themes/icons.css}" rel="stylesheet"
          type="text/css"/>
    <link href="../static/lib/miniui/themes/default/miniui.css" th:href="@{/lib/miniui/themes/default/miniui.css}"
          rel="stylesheet" type="text/css"/>

    <link href="../static/css/style.css" th:href="@{/css/style.css}" rel="stylesheet" type="text/css"/>
    <link href="../static/css/my-mini.css" th:href="@{/css/my-mini.css}" rel="stylesheet" type="text/css"/>

    <!--[if lt IE 9]>
    <script src="../js/html5shiv.min.js" th:src="@{/js/html5shiv.min.js}"></script>
    <script src="../js/respond.js" th:src="@{/js/respond.js}"></script>
    <![endif]-->
    <!--[if lte IE 11]>
    <script type="text/javascript" src="../static/js/flexie.js" th:src="@{/js/flexie.js}"></script>
    <script type="text/javascript" src="../static/js/selectivizr.js" th:src="@{/js/selectivizr.js}"></script>
    <script type="text/javascript" src="../static/js/PIE_IE678.js" th:src="@{/js/PIE_IE678.js}"></script>
    <![endif]-->
    <link href="../lib/font-awesome/css/font-awesome.min.css" th:href="@{/lib/font-awesome/css/font-awesome.min.css}"
          rel="stylesheet" type="text/css"/>

    <meta charset="UTF-8">
    <title>初筛信息汇总(阴性)</title>
</head>
<body>

<div class="content pd-10" style="width:auto; overflow: hidden;">
    <div align="center">初筛信息汇总(阴性)</div>
    <div class="col-lg-12">

        <div class="mini-clearfix">
            <div class="tab-content">
                <div class="secher">
                    <div id="formsearch" class="row mt-10">
                        <!--/*@thymesVar id="#dic" type="com.wonders.health.tumor.common.tags.DictData"*/-->
                        <!--/*@thymesVar id="#auth" type="com.wonders.health.tumor.common.tags.AuthData"*/-->
                        <div class="mini-col-3">
                            <label class="mr-5">登记机构所属区：</label>
                            <input id="regarea" name="regarea" showNullItem="true" class="mini-combobox" width="46%"
                                   th:data="${#auth.getAreas(areaCode)}"
                                   textField="text" valueField="id" onvaluechanged="getHospitals()"
                                   th:value="${role =='sjk' ? '':areaCode}"
                                   th:showNullItem="${role =='sjk' ? true:false}"
                                   th:disabled="${role =='sjk' ? false:true}"/>
                        </div>
                        <div class="mini-col-3">
                            <label class="mr-5">登记机构：</label>

                            <input id="regorg" name="regorg" class="mini-combobox" width="66%" emptyText="请选择"
                                   textField="text" valueField="id"
                                   th:value="${role =='bsq' ? #auth.currUser().orgCode:''}"
                                   th:showNullItem="${role =='bsq' ? false:true}"
                                   th:disabled="${role =='bsq' ? true:false}"/>
                        </div>
                    </div>
                    <div class="col-sm-4 col-lg-3">日期范围：
                        <input id="csrqStart" name="beginDate" class="mini-datepicker"
                               allowInput="true" th:value="${tjRqStart}"  style="width:115px;"  errorMode="border" onvalidation="dateValidation" >
                        -
                        <input id="csrqEnd" name="endDate" class="mini-datepicker"
                               th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" allowInput="false" style="width:115px;" errorMode="border" onvalidation="dateValidation">
                        <div id="js" class="my-btn my-btn-blue" onclick="onSearch()">检索</div>
                        <div class="my-btn my-btn-blue" onclick="reset()">重置</div>
                    </div>


                    <div class="col-sm-2" align="left">
                        <input id="crc" name="checkbox" value="1" class="mini-checkbox"/>大肠癌初筛阴性
                        <input id="lic" name="checkbox" value="1" class="mini-checkbox"/>肝癌初筛阴性
                        <input id="luc" name="checkbox" value="1" class="mini-checkbox"/>肺癌初筛阴性
                        <input id="sc" name="checkbox" value="1" class="mini-checkbox"/>胃癌初筛阴性
                    </div>
                    <div class="col-sm-2" align="right">
                        <div class="my-btn my-btn-blue" onclick="exportData()">导出</div>
                    </div>

                </div>
                <div>
                    <div id="datagrid" url="../statistics/negativeData" class="mini-datagrid" style=" overflow: auto;width: calc(100vw - 25px);height: auto ;display: none;"
                         showpager='false' idField="id">
                        <div property="columns" >
                            <div field="xm"  width="100px" headerAlign="center" style="min-width:100px; width:auto;" align="center">姓名</div>
                            <div field="xb" type="comboboxcolumn" autoShowPopup="true" width="50px" headerAlign="center" align="center" allowSort="false">性别
                                <input property="editor" class="mini-combobox" style="width:100%;" textField="name"
                                       valueField="code" th:data="${#dic.generals('60023')}"/></div>
                            <div field="birthday" sortField="birthday"  dateFormat="yyyy-MM-dd"  width="150px" headerAlign="center" align="center" allowSort="false">出生日期</div>
                            <div field="address" sortField="address"    width="150px" headerAlign="center" align="center" allowSort="false">居住地址</div>
                            <div field="mobile" sortField="mobile"    width="150px" headerAlign="center" align="center" allowSort="false">移动电话</div>
                            <div field="telephone" sortField="telephone"    width="150px" headerAlign="center" align="center" allowSort="false">固定电话</div>
                            <div field="regorg" sortField="regorg"autoShowPopup="true" width="150px" headerAlign="center" align="center" allowSort="false" >筛查登记机构</div>
                            <div field="csrq" sortField="csrq"  dateFormat="yyyy-MM-dd"  width="150px" headerAlign="center" align="center" allowSort="false">初筛日期</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



            <script type="text/javascript">

                mini.parse();
                var grid = mini.get("datagrid");

                $(function () {
                    getHospitals();
                });

                $(document).ready(function () {

                });
                function onSearch() {

                    $("#js").click(function () {
                        $("#datagrid").show();
                    });
                    var objs=document.getElementsByName('checkbox');
                    var isSel=false;//判断是否有选中项，默认为无
                    for(var i=0;i<objs.length;i++)
                    {
                        if(objs[i].checked==true)
                        {
                            isSel=true;
                            break;
                        }
                    }
                    if(isSel==false)
                    {
                        //miniErrorLocation();
                        showTips('初筛阴性类型至少要选中一个','warning');
                        $("datagrid").hide();
                        return false;
                    }
                    var data = {};
                    data.regarea=mini.get("regarea").getValue();
                    data.regorg = mini.get("regorg").getValue();
                    data.csrqStart = mini.get("csrqStart").getValue();
                    data.csrqEnd = mini.get("csrqEnd").getValue();
                    data.crc = mini.get("crc").getValue();
                    data.lic = mini.get("lic").getValue();
                    data.luc = mini.get("luc").getValue();
                    data.sc = mini.get("sc").getValue();
                    grid.load(data, gridLoadSuccess, gridLoadError);


                    /*var len = $("input[name=checkbox]:checked").length;
                    if (len==0){
                        miniErrorLocation();
                        showTips('初筛阴性类型至少要选中一个','warning');
                        $("#datagrid").hide();
                        return;
                    }*/
                }



                /**
                 * miniui 小提示
                 * @param msg  消息
                 * @param state  消息类型  default|success|info|warning|danger
                 */
                function showTips(msg,state) {
                    mini.showTips({
                        content: msg,
                        state: state,
                        x: "center",
                        y: "center",
                        timeout: 3000
                    });
                }



                function getHospitals() {
                    var regarea = mini.get("regarea").getValue();
                    var url = "../dicHospitalInfo/getHospitalsByAreaCode?areaCode=" + regarea;
                    mini.get("regorg").setUrl(url);
                }


                //导出
                function exportData(){
                    var crc = mini.get("crc").getValue();
                    var lic = mini.get("lic").getValue();
                    var luc = mini.get("luc").getValue();
                    var sc  = mini.get("sc").getValue();
                    var regarea=mini.get("regarea").getValue();
                    var regorg=mini.get("regorg").getValue();
                    var csrqStart=mini.get("csrqStart").getValue();
                    var csrqEnd=mini.get("csrqEnd").getValue();
                    var param ='?';
                    param += 'regarea='+regarea;
                    param += '&regorg='+regorg;
                    param += '&crc='+crc;
                    param += '&lic='+lic;
                    param += '&luc='+luc;
                    param += '&sc=' +sc;
                    /* param += '&csrqStart='+csrqStart;
                     param += '&csrqEnd='+csrqEnd;*/
                    window.location.href="../statistics/exportNegativeData"+param;
                }

            </script>

        </div>

    </div>


</body>
</html>