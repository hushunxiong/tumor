<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wonders.health.tumor.statistics.dao.StatisticsDao">
    <!--初筛信息汇总表（阴性）-->
    <sql id="pageFromAndWhereNegative">
        from (
        select
        info.NAME AS xm,
        info.gender AS xb,
        to_char(info.birth,'yyyy-MM-dd') AS birthday,
        info.address_province AS addressProvince,
        info.address_city AS addressCity,
        info.address_county AS addressCounty,
        info.address_town AS addressTown,
        info.address_committee AS addressCommittee,
        info.address_detail AS addressDetail,
        info.mobile AS mobile,
        info.telephone,
        t2.REGORG as REGORG,
        t2.csrq as csrq
        from (
        SELECT
        t.REGORG,
        t.csrq,
        t.manageid
        FROM(
        <if test="crc==true">
            SELECT
            crc.MANAGEID as manageid,
            crc.regorg AS regorg,
            to_char(crc.regdate,'yyyy-MM-dd')AS csrq
            FROM
            CRC_REGCASE crc
            where
            crc.CHECK_RESULT=1
            and crc.del_flag=0
            <if test="csrqStart !=null">
                and crc.regdate >=#{csrqStart}
            </if>
            <if test="csrqEnd !=null">
                and crc.regdate &lt;#{csrqEnd}+1
            </if>
            <if test="regarea !=null and regarea!=''">
                and crc.region_code=#{regarea}
            </if>
            <if test="regorg != null and regorg !=''">
                and crc.regorg=#{regorg}
            </if>
            <if test="sc==true or luc==true or lic==true ">
                union all
            </if>
        </if>
        <if test="lic==true">
            SELECT
            lic.MANAGEID as manageid,
            lic.regorg AS regorg,
            to_char(lic.regdate,'yyyy-MM-dd')AS csrq
            FROM
            LIC_REGCASE lic
            where
            lic.CHECK_RESULT=1
            and lic.del_flag=0
            <if test="csrqStart !=null">
                and lic.regdate >=#{csrqStart}
            </if>
            <if test="csrqEnd !=null">
                and lic.regdate &lt;#{csrqEnd}+1
            </if>
            <if test="regarea !=null and regarea!=''">
                and lic.region_code=#{regarea}
            </if>
            <if test="regorg != null and regorg !=''">
                and lic.regorg=#{regorg}
            </if>
            <if test="sc==true or luc==true ">
                union all
            </if>
        </if>
        <if test="luc==true">
            SELECT
            luc.MANAGEID as manageid,
            luc.regorg AS regorg,
            to_char(luc.regdate,'yyyy-MM-dd') AS csrq
            FROM
            LUC_REGCASE luc
            where
            luc.CHECK_RESULT=1
            and luc.del_flag=0
            <if test="csrqStart !=null">
                and luc.regdate >=#{csrqStart}
            </if>
            <if test="csrqEnd !=null">
                and luc.regdate &lt;#{csrqEnd}+1
            </if>
            <if test="regarea !=null and regarea!=''">
                and luc.region_code=#{regarea}
            </if>

            <if test="regorg != null and regorg !=''">
                and luc.regorg=#{regorg}
            </if>
            <if test="sc==true">
                union all
            </if>
        </if>
        <if test="sc==true">
            SELECT
            sc.MANAGEID as manageid,
            sc.regorg AS regorg,
            to_char(sc.regdate,'yyyy-MM-dd') AS csrq
            FROM
            SC_REGCASE sc
            where
            sc.CHECK_RESULT=1
            and sc.del_flag=0
            <if test="csrqStart !=null">
                and sc.regdate >=#{csrqStart}
            </if>
            <if test="csrqEnd !=null">
                and sc.regdate &lt;#{csrqEnd}+1
            </if>
            <if test="regarea !=null and regarea!=''">
                and sc.region_code=#{regarea}
            </if>
            <if test="regorg != null and regorg !=''">
                and sc.regorg=#{regorg}
            </if>
        </if>

        ) t
        GROUP BY
        t.REGORG,
        t.CSRQ,
        t.MANAGEID having count(1)=#{count}
        ) t2 left join cancer_person_info info on t2.MANAGEID=info.ID
        where info.del_flag=0) negative
    </sql>

    <select id="pageCountNegative" resultType="java.lang.Integer"
            parameterType="com.wonders.health.tumor.common.model.DataGridSearch">
        select count(1)
        <include refid="pageFromAndWhereNegative"/>
    </select>
    <select id="getNegative" parameterType="com.wonders.health.tumor.statistics.vo.SummarySearchVo"
            resultType="com.wonders.health.tumor.statistics.vo.NegativeSummaryVo">
        <choose>
            <when test="startRecord == 0">
                select * from (
            </when>
            <otherwise>
                select * from ( select row_.*, rownum rownum_ from (
            </otherwise>
        </choose>
        SELECT
        *
        <include refid="pageFromAndWhereNegative"/>
        <choose>
            <when test="sortField != null and sortField != '' and sortOrder != '' and sortOrder != ''">
                ORDER BY ${sortField} ${sortOrder}
            </when>
            <otherwise>
                ORDER BY  negative.csrq asc
            </otherwise>
        </choose>
        <choose>
            <when test="startRecord == 0">
                ) row_ where rownum &lt;= #{pageSize}
            </when>
            <otherwise>
                ) row_ where rownum &lt;= #{endRecord}) where rownum_ &gt; #{startRecord}
            </otherwise>
        </choose>

    </select>

    <!--初筛信息汇总（阳性大肠癌）-->
    <sql id="pageFromAndWhereCrcPositive">
        FROM
        crc_regcase crc
        LEFT JOIN cancer_person_info info ON crc.manageid =info.id AND info.del_flag =0
        left join crc_risk_assessment crcrisk on crc.ID =crcrisk.CRC_CHECK_ID and crcrisk.del_flag=0
        left join crc_fobt crcfobt on crc.ID=crcfobt.CRC_CHECK_ID and crcfobt.del_flag=0
        left join crc_follow crcfo on crc.ID=crcfo.CRC_CHECK_ID and crcfo.del_flag=0
        WHERE
        crc.check_result =2
        and crc.del_flag=0
        <if test="csrqStart !=null">
            and crc.regdate >=#{csrqStart}
        </if>
        <if test="csrqEnd !=null">
            and crc.regdate &lt;#{csrqEnd}+1
        </if>
        <if test="regarea !=null and regarea!=''">
            and crc.region_code=#{regarea}
        </if>
        <if test="regorg != null and regorg !=''">
            and crc.regorg=#{regorg}
        </if>
    </sql>
    <select id="pageCountCrcPositive" resultType="java.lang.Integer"
            parameterType="com.wonders.health.tumor.common.model.DataGridSearch">
        select count(1)
        <include refid="pageFromAndWhereCrcPositive"/>
    </select>
    <select id="getCrcPositive" parameterType="com.wonders.health.tumor.statistics.vo.SummarySearchVo"
            resultType="com.wonders.health.tumor.statistics.vo.CrcPositiveSummaryVo">
        <choose>
            <when test="startRecord == 0">
                select * from (
            </when>
            <otherwise>
                select * from ( select row_.*, rownum rownum_ from (
            </otherwise>
        </choose>
        SELECT
        info.NAME AS xm,
        info.gender AS xb,
        to_char(info.birth,'yyyy-MM-dd')AS birthday,
        info.address_province as addressProvince,
        info.address_city as addressCity,
        info.address_county as addressCounty,
        info.address_town as addressTown,
        info.address_committee as addressCommittee,
        info.address_detail as addressDetail,
        crcrisk.ASSESSMENT_RESULT as assessmentResult,
        crcfobt.FOBT_RESULT as fobtResult,
        crcfo.CHANGJING as changjing,
        crcfo.SHIFOUQUEZHEN as sfqz,
        crcfo.SHIFOUZHILIAO as sfzl,
        crcfo.linchuangfenqi_putuo as zlqb,
        crcfo.BINGBIANBUW as zlwz,
        info.mobile as mobile,
        info.telephone,
        crc.regorg as regorg,
        to_char(crc.regdate,'yyyy-MM-dd')AS csrq
        <include refid="pageFromAndWhereCrcPositive"/>
        <choose>
            <when test="sortField != null and sortField != '' and sortOrder != '' and sortOrder != ''">
                ORDER BY ${sortField} ${sortOrder}
            </when>
            <otherwise>
                ORDER BY  crc.regdate asc
            </otherwise>
        </choose>
        <choose>
            <when test="startRecord == 0">
                ) row_ where rownum &lt;= #{pageSize}
            </when>
            <otherwise>
                ) row_ where rownum &lt;= #{endRecord}) where rownum_ &gt; #{startRecord}
            </otherwise>
        </choose>
    </select>


    <!--初筛信息汇总（阳性肝癌）-->
    <sql id="pageFromAndWhereLicPositive">
        FROM
        lic_regcase lic
        LEFT JOIN cancer_person_info info ON info.id = lic.MANAGEID AND info.del_flag = 0
        LEFT JOIN lic_risk_assessment licrisk ON lic.id = licrisk.lic_CHECK_ID and licrisk.del_flag = 0
        LEFT JOIN lic_FOLLOW licfo ON lic.id = licfo.lic_CHECK_ID and licfo.del_flag = 0
        LEFT JOIN lic_assist_check licac on lic.ID = licac.lic_check_id and licac.del_flag = 0
        WHERE
        lic.check_result = 2
        and lic.del_flag=0
        <if test="csrqStart !=null">
            and lic.regdate >=#{csrqStart}
        </if>
        <if test="csrqEnd !=null">
            and lic.regdate &lt;#{csrqEnd}+1
        </if>
        <if test="regarea !=null and regarea!=''">
            and lic.region_code=#{regarea}
        </if>
        <if test="regorg != null and regorg !=''">
            and lic.regorg=#{regorg}
        </if>
    </sql>

    <select id="pageCountLicPositive" resultType="java.lang.Integer"
            parameterType="com.wonders.health.tumor.common.model.DataGridSearch">
        select count(1)
        <include refid="pageFromAndWhereLicPositive"/>
    </select>

    <select id="getLicPositive" parameterType="com.wonders.health.tumor.statistics.vo.SummarySearchVo"
            resultType="com.wonders.health.tumor.statistics.vo.LicPositiveSummaryVo">
        <choose>
            <when test="startRecord == 0">
                select * from (
            </when>
            <otherwise>
                select * from ( select row_.*, rownum rownum_ from (
            </otherwise>
        </choose>
        SELECT
        info.NAME AS xm,
        info.gender AS xb,
        to_char(info.birth,'yyyy-MM-dd') AS birthday,
        info.address_province AS addressProvince,
        info.address_city AS addressCity,
        info.address_county AS addressCounty,
        info.address_town AS addressTown,
        info.address_committee AS addressCommittee,
        info.address_detail AS addressDetail,
        info.mobile AS mobile,
        info.telephone,
        lic.REGORG AS REGORG,
        licrisk.assessment_result AS assessmentResult,
        licac.GTP as GTP,
        licac.HBEG as Hbeg,
        licac.AFP AS AFP,
        licac.Bus as Bus,
        licfo.SHIFOUQUEZHEN AS sfqz,
        licfo.SHIFOUZHILIAO AS sfzl,
        licfo.ZHONGLIUWEIZH AS zlwz,
        licfo.linchuangfenqi AS zlqb,
        to_char(lic.REGDATE,'yyyy-MM-dd')AS csrq
        <include refid="pageFromAndWhereLicPositive"/>
        <choose>
            <when test="sortField != null and sortField != '' and sortOrder != '' and sortOrder != ''">
                ORDER BY ${sortField} ${sortOrder}
            </when>
            <otherwise>
                ORDER BY  lic.regdate asc
            </otherwise>
        </choose>
        <choose>
            <when test="startRecord == 0">
                ) row_ where rownum &lt;= #{pageSize}
            </when>
            <otherwise>
                ) row_ where rownum &lt;= #{endRecord}) where rownum_ &gt; #{startRecord}
            </otherwise>
        </choose>

    </select>


    <!--初筛信息汇总（阳性肺癌）-->
    <sql id="pageFromAndWhereLucPositive">
        FROM
        luc_regcase luc
        LEFT JOIN cancer_person_info info ON info.id = luc.MANAGEID AND info.del_flag = 0
        LEFT JOIN luc_risk_assessment lucrisk ON luc.id = lucrisk.LUC_CHECK_ID and lucrisk.del_flag = 0
        LEFT JOIN LUC_FOLLOW lucfo ON luc.id = lucfo.LUC_CHECK_ID and lucfo.del_flag = 0
        WHERE
        luc.check_result = 2
        and luc.del_flag = 0
        <if test="csrqStart !=null">
            and luc.regdate >=#{csrqStart}
        </if>
        <if test="csrqEnd !=null">
            and luc.regdate &lt;#{csrqEnd}+1
        </if>
        <if test="regarea !=null and regarea!=''">
            and luc.region_code=#{regarea}
        </if>
        <if test="regorg != null and regorg !=''">
            and luc.regorg=#{regorg}
        </if>
    </sql>
    <select id="pageCountLucPositive" resultType="java.lang.Integer"
            parameterType="com.wonders.health.tumor.common.model.DataGridSearch">
        select count(1)
        <include refid="pageFromAndWhereLucPositive"/>
    </select>

    <select id="getLucPositive" parameterType="com.wonders.health.tumor.statistics.vo.SummarySearchVo"
            resultType="com.wonders.health.tumor.statistics.vo.LucPositiveSummaryVo">
        <choose>
            <when test="startRecord == 0">
                select * from (
            </when>
            <otherwise>
                select * from ( select row_.*, rownum rownum_ from (
            </otherwise>
        </choose>
        SELECT
        info.NAME AS xm,
        info.gender AS xb,
        to_char(info.birth,'yyyy-MM-dd') AS birthday,
        info.address_province AS addressProvince,
        info.address_city AS addressCity,
        info.address_county AS addressCounty,
        info.address_town AS addressTown,
        info.address_committee AS addressCommittee,
        info.address_detail AS addressDetail,
        info.mobile AS mobile,
        info.telephone,
        luc.REGORG AS REGORG,
        lucrisk.assessment_result AS assessmentResult,
        lucfo.shifouLDCT AS shifouLDCT,
        lucfo.LDCT_jieguo AS LDCTJieguo,
        lucfo.SHIFOUQUEZHEN AS sfqz,
        lucfo.SHIFOUZHILIAO AS sfzl,
        lucfo.ZHONGLIUWEIZH AS zlwz,
        lucfo.linchuangfenqi AS zlqb,
        to_char(luc.REGDATE,'yyyy-MM-dd') AS csrq
        <include refid="pageFromAndWhereLucPositive"/>
        <choose>
            <when test="sortField != null and sortField != '' and sortOrder != '' and sortOrder != ''">
                ORDER BY ${sortField} ${sortOrder}
            </when>
            <otherwise>
                ORDER BY  luc.REGDATE asc
            </otherwise>
        </choose>
        <choose>
            <when test="startRecord == 0">
                ) row_ where rownum &lt;= #{pageSize}
            </when>
            <otherwise>
                ) row_ where rownum &lt;= #{endRecord}) where rownum_ &gt; #{startRecord}
            </otherwise>
        </choose>
    </select>


    <!--初筛信息汇总（阳性胃癌）-->
    <sql id="pageFromAndWhereScPositive">
        FROM
        sc_regcase sc
        LEFT JOIN cancer_person_info info ON info.id = sc.MANAGEID AND info.del_flag = 0
        LEFT JOIN sc_risk_assessment scrisk ON sc.id = scrisk.sc_CHECK_ID and scrisk.del_flag = 0
        LEFT JOIN sc_FOLLOW scfo ON sc.id = scfo.sc_CHECK_ID and scfo.del_flag = 0
        WHERE
        sc.check_result = 2
        and sc.del_flag = 0
        <if test="csrqStart !=null">
            and sc.regdate >=#{csrqStart}
        </if>
        <if test="csrqEnd !=null">
            and sc.regdate &lt;#{csrqEnd}+1
        </if>
        <if test="regarea !=null and regarea!=''">
            and sc.region_code=#{regarea}
        </if>
        <if test="regorg != null and regorg !=''">
            and sc.regorg=#{regorg}
        </if>
    </sql>

    <select id="pageCountScPositive" resultType="java.lang.Integer"
            parameterType="com.wonders.health.tumor.common.model.DataGridSearch">
        select count(1)
        <include refid="pageFromAndWhereScPositive"/>
    </select>

    <select id="getScPositive" parameterType="com.wonders.health.tumor.statistics.vo.SummarySearchVo"
            resultType="com.wonders.health.tumor.statistics.vo.ScPositiveSummaryVo">
        <choose>
            <when test="startRecord == 0">
                select * from (
            </when>
            <otherwise>
                select * from ( select row_.*, rownum rownum_ from (
            </otherwise>
        </choose>
        SELECT
        info.NAME AS xm,
        info.gender AS xb,
        to_char(info.birth,'yyyy-MM-dd') AS birthday,
        info.address_province AS addressProvince,
        info.address_city AS addressCity,
        info.address_county AS addressCounty,
        info.address_town AS addressTown,
        info.address_committee AS addressCommittee,
        info.address_detail AS addressDetail,
        info.mobile AS mobile,
        info.telephone,
        sc.REGORG AS REGORG,
        scrisk.assessment_result AS assessmentResult,
        scfo.SHIFOUWEIJING as sfwj,
        scfo.WEIJING_JIEGUO as wjjcjg,
        scfo.SHIFOUQUEZHEN AS sfqz,
        scfo.SHIFOUZHILIAO AS sfzl,
        scfo.ZHONGLIUWEIZH AS zlwz,
        scfo.linchuangfenqi AS zlqb,
        to_char(sc.REGDATE,'yyyy-MM-dd') AS csrq
        <include refid="pageFromAndWhereScPositive"/>
        <choose>
            <when test="sortField != null and sortField != '' and sortOrder != '' and sortOrder != ''">
                ORDER BY ${sortField} ${sortOrder}
            </when>
            <otherwise>
                ORDER BY  sc.REGDATE asc
            </otherwise>
        </choose>
        <choose>
            <when test="startRecord == 0">
                ) row_ where rownum &lt;= #{pageSize}
            </when>
            <otherwise>
                ) row_ where rownum &lt;= #{endRecord}) where rownum_ &gt; #{startRecord}
            </otherwise>
        </choose>
    </select>
    <!--诊断信息收集表-->
    <sql id="pageFromAndWhereInformation">
        FROM
        (SELECT
        info.NAME AS xm,
        info.PERSONCARD_TYPE AS personcardType,
        info.PERSONCARD AS personcard,
        t.MANAGEID AS MANAGEID,
        t.REGORG AS REGORG,
        t.CHANGJING as changjing,
        t.SHIFOULDCT as SHIFOULDCT,
        t.SHIFOUWEIJING as SHIFOUWEIJING,
        t.bbbw AS bbbw,
        t.zldx AS zldx,
        t.sfhj AS sfhj,
        t.hjjg AS hjjg,
        t.sfbl AS sfbl,
        t.bllx AS bllx,
        t.ZHONGLIUTNM_T,
        t.ZHONGLIUTNM_N,
        t.ZHONGLIUTNM_M,
        t.sfrq AS sfrq
        FROM
        (
        <if test=" crcFlag !=null and crcFlag !='' and crcFlag == '1'.toString()">
            SELECT
            crc.MANAGEID AS MANAGEID,
            crc.REGORG AS REGORG,
            crcfo.changjing as changjing,
            null as shifouLDCT,
            null as shifouweijing,
            dic.NAME AS bbbw,
            crcfo.bingbianDaXiao AS zldx,
            crcfo.huojian AS sfhj,
            dict.NAME AS hjjg,
            crcfo.BINGLI AS sfbl,
            crcfo.binglileixing AS bllx,
            crcfo.ZHONGLIUTNM_T,
            crcfo.ZHONGLIUTNM_N,
            crcfo.ZHONGLIUTNM_M,
            to_char(crcfo.SUIFANG_DATE,'yyyy-MM-dd') AS sfrq
            FROM
            CRC_FOLLOW crcfo
            LEFT JOIN crc_regcase crc ON crc.ID = crcfo.CRC_CHECK_ID
            left join  (select code,name from cancer_dic where id = '60031') dic on crcfo.BINGBIANBUW = dic.code
            left join (select code,name from cancer_dic where id = '60033') dict on crcfo.huojianjieguo = dict.code
            where
            crc.del_flag = 0
            and crcfo.del_flag = 0
            <if test="csrqStart !=null">
                and crcfo.suifang_date >=#{csrqStart}
            </if>
            <if test="csrqEnd !=null">
                and crcfo.suifang_date &lt;#{csrqEnd}+1
            </if>
            <if test="regarea !=null and regarea!=''">
                and crc.region_code=#{regarea}
            </if>
            <if test="regorg != null and regorg !=''">
                and crc.regorg=#{regorg}
            </if>
            UNION ALL
        </if>
        <if test=" licFlag !=null and licFlag !='' and licFlag == '1'.toString()">
            SELECT
            lic.MANAGEID AS MANAGEID,
            lic.REGORG AS REGORG,
            null as changjing,
            null as shifouLDCT,
            null as shifouweijing,
            licfo.zhongliuweizh AS bbbw,
            licfo.zhongliudaxiao AS zldx,
            licfo.huojian AS sfhj,
            licfo.huojianjieguo AS hjjg,
            licfo.BINGLI AS sfbl,
            licfo.binglileixing AS bllx,
            licfo.ZHONGLIUTNM_T,
            licfo.ZHONGLIUTNM_N,
            licfo.ZHONGLIUTNM_M,
            to_char(licfo.SUIFANG_DATE,'yyyy-MM-dd') AS sfrq
            FROM
            lic_FOLLOW licfo
            LEFT JOIN lic_regcase lic  ON lic.ID = licfo.LIC_CHECK_ID
            where
            lic.del_flag = 0
            and licfo.del_flag = 0
            <if test="csrqStart !=null">
                and licfo.suifang_date >=#{csrqStart}
            </if>
            <if test="csrqEnd !=null">
                and licfo.suifang_date &lt;#{csrqEnd}+1
            </if>
            <if test="regarea !=null and regarea!=''">
                and lic.region_code=#{regarea}
            </if>
            <if test="regorg != null and regorg !=''">
                and lic.regorg=#{regorg}
            </if>
            UNION ALL
        </if>
        <if test=" lucFlag !=null and lucFlag !='' and lucFlag == '1'.toString()">

            SELECT
            luc.MANAGEID AS MANAGEID,
            luc.REGORG AS REGORG,
            null as changjing,
            lucfo.shifouLDCT as shifouLDCT,
            null as shifouweijing,
            lucfo.zhongliuweizh AS bbbw,
            lucfo.zhongliudaxiao AS zldx,
            lucfo.huojian AS sfhj,
            lucfo.huojianjieguo AS hjjg,
            lucfo.BINGLI AS sfbl,
            lucfo.binglileixing AS bllx,
            lucfo.ZHONGLIUTNM_T,
            lucfo.ZHONGLIUTNM_N,
            lucfo.ZHONGLIUTNM_M,
            to_char(lucfo.SUIFANG_DATE,'yyyy-MM-dd') AS sfrq
            FROM
             luc_FOLLOW lucfo
            LEFT JOIN luc_regcase luc ON luc.ID = lucfo.luc_CHECK_ID
            where
            luc.del_flag = 0
            and lucfo.del_flag = 0
            <if test="csrqStart !=null">
                and lucfo.suifang_date >=#{csrqStart}
            </if>
            <if test="csrqEnd !=null">
                and lucfo.suifang_date &lt;#{csrqEnd}+1
            </if>
            <if test="regarea !=null and regarea!=''">
                and luc.region_code=#{regarea}
            </if>
            <if test="regorg != null and regorg !=''">
                and luc.regorg=#{regorg}
            </if>
            UNION ALL
        </if>

        <if test=" scFlag !=null and scFlag !='' and scFlag == '1'.toString()">

            SELECT
            sc.MANAGEID AS MANAGEID,
            sc.REGORG AS REGORG,
            null as changjing ,
            null as shifouLDCT,
            scfo.shifouweijing as shifouweijing,
            scfo.zhongliuweizh AS bbbw,
            scfo.zhongliudaxiao AS zldx,
            scfo.huojian AS sfhj,
            scfo.huojianjieguo AS hjjg,
            scfo.BINGLI AS sfbl,
            scfo.binglileixing AS bllx,
            scfo.ZHONGLIUTNM_T,
            scfo.ZHONGLIUTNM_N,
            scfo.ZHONGLIUTNM_M,
            to_char(scfo.SUIFANG_DATE,'yyyy-MM-dd') AS sfrq
            FROM
            sc_FOLLOW scfo
            LEFT JOIN sc_regcase sc  ON sc.ID = scfo.sc_CHECK_ID
            where
            sc.del_flag = 0
            and scfo.del_flag = 0
            <if test="csrqStart !=null">
                and scfo.suifang_date >=#{csrqStart}
            </if>
            <if test="csrqEnd !=null">
                and scfo.suifang_date &lt;#{csrqEnd}+1
            </if>
            <if test="regarea !=null and regarea!=''">
                and sc.region_code=#{regarea}
            </if>
            <if test="regorg != null and regorg !=''">
                and sc.regorg=#{regorg}
            </if>
        </if>
        ) t
        LEFT JOIN CANCER_PERSON_INFO info ON t.MANAGEID = info.ID
        WHERE
        info.DEL_FLAG =0) information
    </sql>
    <select id="pageCountInformation" resultType="java.lang.Integer"
            parameterType="com.wonders.health.tumor.common.model.DataGridSearch">
        select count(1)
        <include refid="pageFromAndWhereInformation"/>
    </select>
    <select id="getInformation" parameterType="com.wonders.health.tumor.statistics.vo.SummarySearchVo"
            resultType="com.wonders.health.tumor.statistics.vo.InformationCollectionVo">
        <choose>
            <when test="startRecord == 0">
                select * from (
            </when>
            <otherwise>
                select * from ( select row_.*, rownum rownum_ from (
            </otherwise>
        </choose>
        SELECT
            *
        <include refid="pageFromAndWhereInformation"/>
        <choose>
            <when test="sortField != null and sortField != '' and sortOrder != '' and sortOrder != ''">
                ORDER BY ${sortField} ${sortOrder}
            </when>
            <otherwise>
                ORDER BY  information.sfrq,information.personcard asc
            </otherwise>
        </choose>
        <choose>
            <when test="startRecord == 0">
                ) row_ where rownum &lt;= #{pageSize}
            </when>
            <otherwise>
                ) row_ where rownum &lt;= #{endRecord}) where rownum_ &gt; #{startRecord}
            </otherwise>
        </choose>
    </select>

    <!--社区卫生服务中心肿瘤早发现进度表(社区登录的场合)-->
    <sql id="pageFromAndWhereCRC">
        FROM
        crc_regcase cancer
        LEFT JOIN cancer_person_info info ON cancer.manageid =info.id AND info.del_flag =0
        left join crc_risk_assessment risk on cancer.ID =risk.CRC_CHECK_ID and risk.del_flag=0
        left join crc_fobt crcfobt on cancer.ID=crcfobt.CRC_CHECK_ID and crcfobt.del_flag=0
        left join crc_follow fo on cancer.ID=fo.CRC_CHECK_ID and fo.del_flag=0
        WHERE
        cancer.del_flag=0
        <if test="regorg != null and regorg !=''">
            and cancer.regorg=#{regorg}
        </if>
        <if test="year != null and year !=''">
            and to_char(cancer.REGDATE,'yyyy')=#{year}
        </if>
    </sql>
    <sql id="pageFromAndWhereSC">
        FROM
        sc_regcase cancer
        LEFT JOIN sc_risk_assessment risk ON cancer.id = risk.sc_CHECK_ID and risk.del_flag = 0
        LEFT JOIN sc_FOLLOW fo ON cancer.id = fo.sc_CHECK_ID and fo.del_flag = 0
        WHERE
        cancer.del_flag = 0
        <if test="regorg !=null and regorg !=''">
            and cancer.regorg=#{regorg}
        </if>
        <if test="year != null and year !=''">
            and to_char(cancer.REGDATE,'yyyy')=#{year}
        </if>
    </sql>
    <sql id="pageFromAndWhereLIC">
        FROM
        lic_regcase cancer
        LEFT JOIN cancer_person_info info ON info.id = cancer.MANAGEID AND info.del_flag = 0
        LEFT JOIN lic_risk_assessment risk ON cancer.id = risk.lic_CHECK_ID and risk.del_flag = 0
        LEFT JOIN lic_FOLLOW fo ON cancer.id = fo.lic_CHECK_ID and fo.del_flag = 0
        LEFT JOIN lic_assist_check licac on cancer.ID = licac.lic_check_id and licac.del_flag = 0
        WHERE
        cancer.del_flag = 0
        <if test="regorg !=null and regorg !=''">
            and cancer.regorg=#{regorg}
        </if>
        <if test="year != null and year !=''">
            and to_char(cancer.REGDATE,'yyyy')=#{year}
        </if>
    </sql>
    <sql id="pageFromAndWhereLUC">
        FROM
        luc_regcase cancer
        LEFT JOIN cancer_person_info info ON info.id = cancer.MANAGEID AND info.del_flag = 0
        LEFT JOIN luc_risk_assessment risk ON cancer.id = risk.LUC_CHECK_ID and risk.del_flag = 0
        LEFT JOIN LUC_FOLLOW fo ON cancer.id = fo.LUC_CHECK_ID and fo.del_flag = 0
        WHERE
        cancer.del_flag = 0
        <if test="regorg !=null and regorg !=''">
            and cancer.regorg=#{regorg}
        </if>
        <if test="year != null and year !=''">
            and to_char(cancer.REGDATE,'yyyy')=#{year}
        </if>
    </sql>
    <!--查询页数-->
    <select id="pageCountSeSchedule" resultType="java.lang.Integer"
            parameterType="com.wonders.health.tumor.statistics.vo.SeScheduleSearchVo">
        <choose>
            <when test="summary!=null and  summary!=''">
                select count(1) from (
                select count(1)
            </when>
        </choose>
        <choose>
            <when test="summary==1">
                <include refid="pageFromAndWhereCRC"/>
            </when>
            <when test="summary==2">
                <include refid="pageFromAndWhereLUC"/>
            </when>
            <when test="summary==3">
                <include refid="pageFromAndWhereSC"/>
            </when>
            <when test="summary==4">
                <include refid="pageFromAndWhereLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary!=null and  summary!=''">
                group by to_char(cancer.REGDATE,'yyyy'),to_char(cancer.REGDATE,'mm')
                )
            </when>
        </choose>
    </select>

    <sql id="seScheduleCRCList">
        case when sum(case when fo.zhongliuleix is not null and fo.huojianjieguo='09' then 1 else 0 end)=0 then '0%' else round((sum(case when (fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05') and fo.zhongliuTNM_N='02' and fo.zhongliuTNM_M='01' then 1 else 0 end)/sum(case when fo.zhongliuleix is not null or fo.huojianjieguo='09' then 1 else 0 end)),4)*100||'%' end as earlyDiagnosisRate,
        sum(case when changjing=1 then 1 else 0 end) as crcCheckNum,
        case when sum(case when risk.assessment_result=2 then 1 else 0 end)=0 then '0%' else round((sum(case when changjing=1 then 1 else 0 end)/sum(case when risk.assessment_result=2 then 1 else 0 end)),4)*100||'%' end as crcCheckRate,
        sum(case when fo.huojianjieguo='04' or fo.huojianjieguo='05' or fo.huojianjieguo='06' or fo.huojianjieguo='07' or fo.huojianjieguo='08' or fo.huojianjieguo='12' or fo.huojianjieguo='13' or fo.huojianjieguo='14' then 1 else 0 end) as crcLesionNum,
        sum(case when fo.bingbianchuli=1 then 1 else 0 end) as crcLesionRate,
        sum(case when fo.zhongliuleix is not null or fo.huojianjieguo='09' then 1 else 0 end) as crcCaseNum
    </sql>
    <sql id="seScheduleLUCList">
        case when sum(case when fo.shifouquezhen=1 then 1 else 0 end)=0 then '0%' else round((sum(case when (fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05') and fo.zhongliuTNM_N='02' and fo.zhongliuTNM_M='01' then 1 else 0 end)/sum(case when fo.shifouquezhen=1 then 1 else 0 end)),4)*100||'%' end as earlyDiagnosisRate,
        sum(case when fo.shifouLDCT=1 then 1 else 0 end) as lucCheckNum,
        case when sum(case when fo.shifouLDCT=1 then 1 else 0 end)=0 then '0%' else round((sum(case when fo.shifouLDCT=1 then 1 else 0 end)/sum(case when risk.assessment_result=2 then 1 else 0 end)),4)*100||'%' end as lucCheckRate,
        sum(case when fo.shifouquezhen=1 then 1 else 0 end) as lucCaseNum
    </sql>
    <sql id="seScheduleSCList">
        case when sum(case when shifouquezhen=1 then 1 else 0 end)=0 then '0%' else round((sum(case when (fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05')
        and fo.zhongliuTNM_N='02' and fo.zhongliuTNM_M='01' then 1 else 0 end)/ sum(case when shifouquezhen=1 then 1 else 0 end)),4)*100||'%' end as earlyDiagnosisRate,
        sum(case when shifouweijing=1 then 1 else 0 end) as scCheckNum,
        case when sum(case when risk.assessment_result=2 then 1 else 0 end)=0 then '0%' else round((sum(case when shifouweijing=1 then 1 else 0 end)/sum(case when risk.assessment_result=2 then 1 else 0 end)),4)*100||'%' end as scCheckRate,
        sum(case when shifouquezhen=1 then 1 else 0 end) as scCaseNum
    </sql>
    <sql id="seScheduleLICList">
        case when sum(case when shifouquezhen=1 then 1 else 0 end)=0 then '0%' else round((sum(case when (fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05') and
        fo.zhongliuTNM_N='02' and fo.zhongliuTNM_M='01' then 1 else 0 end)/sum(case when shifouquezhen=1 then 1 else 0 end)),4)*100||'%' end as earlyDiagnosisRate,
        sum(case when shifouquezhen=1 then 1 else 0 end) as licCaseNum
    </sql>
    <sql id="seScheduleLists">
        count(*) as num,
        sum(case when risk.assessment_result is not null then 1 else 0 end) as summary,
        sum(case when risk.assessment_result=2 then 1 else 0 end) as regCaseNum,
        case when count(*)=0 then '0%' else round((sum(case when risk.assessment_result=2 then 1 else 0 end)/count(*)),4)*100||'%' end as regCaseRate,
        sum(case when (fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05') and fo.zhongliuTNM_N='02' and fo.zhongliuTNM_M='01' then 1 else 0 end) as earlyDiagnosisNum,
    </sql>
    <select id="getSeSchedule" parameterType="com.wonders.health.tumor.statistics.vo.SeScheduleSearchVo"
            resultType="com.wonders.health.tumor.statistics.vo.SeScheduleListVo">
        <choose>
            <when test="startRecord == 0">
                select * from (
            </when>
            <otherwise>
                select * from ( select row_.*, rownum rownum_ from (
            </otherwise>
        </choose>
        <choose>
            <when test="summary !=null and summary!=''">
                SELECT
                to_char(cancer.REGDATE,'yyyy') as year,
                to_char(cancer.REGDATE,'mm') as month,
                <include refid="seScheduleLists"/>
            </when>
        </choose>
        <choose>
            <when test="summary == 1">
                <include refid="seScheduleCRCList"/>
                <include refid="pageFromAndWhereCRC"/>
            </when>
            <when test="summary == 2">
                <include refid="seScheduleLUCList"/>
                <include refid="pageFromAndWhereLUC"/>
            </when>
            <when test="summary == 3">
                <include refid="seScheduleSCList"/>
                <include refid="pageFromAndWhereSC"/>
            </when>
            <when test="summary == 4">
                <include refid="seScheduleLICList"/>
                <include refid="pageFromAndWhereLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary !=null and summary!=''">
                group by to_char(cancer.REGDATE,'yyyy'),to_char(cancer.REGDATE,'mm')
            </when>
        </choose>
        <choose>
            <when test="summary !=null and summary!=''">
            union all
                SELECT
                '' as year,
                '合计' as month,
                <include refid="seScheduleLists"/>
            </when>
        </choose>
        <choose>
            <when test="summary == 1">
                <include refid="seScheduleCRCList"/>
                <include refid="pageFromAndWhereCRC"/>
            </when>
            <when test="summary == 2">
                <include refid="seScheduleLUCList"/>
                <include refid="pageFromAndWhereLUC"/>
            </when>
            <when test="summary == 3">
                <include refid="seScheduleSCList"/>
                <include refid="pageFromAndWhereSC"/>
            </when>
            <when test="summary == 4">
                <include refid="seScheduleLICList"/>
                <include refid="pageFromAndWhereLIC"/>
            </when>
        </choose>
        <choose>
            <when test="sortField != null and sortField != '' and sortOrder != '' and sortOrder != ''">
                ORDER BY ${sortField} ${sortOrder}
            </when>
            <otherwise>
                ORDER BY  month asc
            </otherwise>
        </choose>
        <choose>
            <when test="startRecord == 0">
                ) row_ where rownum &lt;= #{pageSize}
            </when>
            <otherwise>
                ) row_ where rownum &lt;= #{endRecord}) where rownum_ &gt; #{startRecord}
            </otherwise>
        </choose>
    </select>

    <!--社区卫生服务中心肿瘤早发现进度表(区疾控登录的场合)-->
    <sql id="pageSeAreaControlCRC">
        FROM
        crc_regcase cancer
        LEFT JOIN cancer_person_info info ON cancer.manageid =info.id AND info.del_flag =0
        left join crc_risk_assessment risk on cancer.ID =risk.CRC_CHECK_ID and risk.del_flag=0
        left join crc_fobt crcfobt on cancer.ID=crcfobt.CRC_CHECK_ID and crcfobt.del_flag=0
        left join crc_follow fo on cancer.ID=fo.CRC_CHECK_ID and fo.del_flag=0
        left join cancer_dic_hospital_info dhi on cancer.regorg=dhi.HOSPITAL_ID and dhi.del_flag=0
        WHERE
        cancer.del_flag=0
        <if test="regorg != null and regorg !=''">
            and cancer.regorg=#{regorg}
        </if>
        <if test="csrqStart !=null">
            and fo.suifang_date >=#{csrqStart}
        </if>
        <if test="csrqEnd !=null">
            and fo.suifang_date &lt;#{csrqEnd}+1
        </if>
    </sql>
    <sql id="pageSeAreaControlSC">
        FROM
        sc_regcase cancer
        LEFT JOIN cancer_person_info info ON cancer.manageid =info.id AND info.del_flag =0
        LEFT JOIN sc_risk_assessment risk ON cancer.id = risk.sc_CHECK_ID and risk.del_flag = 0
        LEFT JOIN sc_FOLLOW fo ON cancer.id = fo.sc_CHECK_ID and fo.del_flag = 0
        left join cancer_dic_hospital_info dhi on cancer.regorg=dhi.HOSPITAL_ID and dhi.del_flag=0
        WHERE
        cancer.del_flag = 0
        <if test="regorg !=null and regorg !=''">
            and cancer.regorg=#{regorg}
        </if>
        <if test="csrqStart !=null">
            and fo.suifang_date >=#{csrqStart}
        </if>
        <if test="csrqEnd !=null">
            and fo.suifang_date &lt;#{csrqEnd}+1
        </if>
    </sql>
    <sql id="pageSeAreaControlLIC">
        FROM
        lic_regcase cancer
        LEFT JOIN cancer_person_info info ON info.id = cancer.MANAGEID AND info.del_flag = 0
        LEFT JOIN lic_risk_assessment risk ON cancer.id = risk.lic_CHECK_ID and risk.del_flag = 0
        LEFT JOIN lic_FOLLOW fo ON cancer.id = fo.lic_CHECK_ID and fo.del_flag = 0
        LEFT JOIN lic_assist_check licac on cancer.ID = licac.lic_check_id and licac.del_flag = 0
        left join cancer_dic_hospital_info dhi on cancer.regorg=dhi.HOSPITAL_ID and dhi.del_flag=0
        WHERE
        cancer.del_flag = 0
        <if test="regorg !=null and regorg !=''">
            and cancer.regorg=#{regorg}
        </if>
        <if test="csrqStart !=null">
            and fo.suifang_date >=#{csrqStart}
        </if>
        <if test="csrqEnd !=null">
            and fo.suifang_date &lt;#{csrqEnd}+1
        </if>
    </sql>
    <sql id="pageSeAreaControlLUC">
        FROM
        luc_regcase cancer
        LEFT JOIN cancer_person_info info ON info.id = cancer.MANAGEID AND info.del_flag = 0
        LEFT JOIN luc_risk_assessment risk ON cancer.id = risk.LUC_CHECK_ID and risk.del_flag = 0
        LEFT JOIN LUC_FOLLOW fo ON cancer.id = fo.LUC_CHECK_ID and fo.del_flag = 0
        left join cancer_dic_hospital_info dhi on cancer.regorg=dhi.HOSPITAL_ID and dhi.del_flag=0
        WHERE
        cancer.del_flag = 0
        <if test="regorg !=null and regorg !=''">
            and cancer.regorg=#{regorg}
        </if>
        <if test="csrqStart !=null">
            and fo.suifang_date >=#{csrqStart}
        </if>
        <if test="csrqEnd !=null">
            and fo.suifang_date &lt;#{csrqEnd}+1
        </if>
    </sql>
    <!--不分类-->
    <sql id="seScheduleNoCategoryCRCList">
         fo.changjing as jc
    </sql>
    <sql id="seScheduleNoCategoryLUCList">
         fo.shifouLDCT as jc
    </sql>
    <sql id="seScheduleNoCategorySCList">
         fo.shifouweijing as jc
    </sql>
    <sql id="seScheduleNoCategoryLICList">
         '' as jc
    </sql>
    <sql id="seScheduleNoCategoryTail">
        ) group by regorg,regorgCode,personcard
        ) group by regorg,regorgCode
    </sql>
    <sql id="seScheduleNoCategoryHead">
        sum(num) as num,
        sum(summary) as summary,
        sum(case when regCaseNum>0 then 1 else 0 end) as regCaseNum,
        case when sum(num)=0 then '0%' else round(sum(case when regCaseNum>0 then 1 else 0 end)/sum(num),4)*100||'%' end as regCaseRate,
        sum(case when confirmeNum>0 then 1 else 0 end) as confirmeNum,
        case when sum(case when regCaseNum>0 then 1 else 0 end)=0 then '0%' else
        round(sum(case when confirmeNum>0 then 1 else 0 end)/sum(case when regCaseNum>0 then 1 else 0 end),4)*100||'%' end as confirmeRate,
        sum(case when confirmeCancerNum>0 then 1 else 0 end) as confirmeCancerNum,
        sum(case when earlyDiagnosisNum>0 then 1 else 0 end) as earlyDiagnosisNum,
        case when sum(case when confirmeCancerNum>0 then 1 else 0 end)=0 then '0%' else
        round(sum(case when earlyDiagnosisNum>0 then 1 else 0 end)/sum(case when confirmeCancerNum>0 then 1 else 0 end),4)*100||'%' end as earlyDiagnosisRate
    FROM(
    select
        regorg,
        regorgCode,
        personcard,
        count(1) as num,
        sum(case when result>0 then 1 else 0 end) as summary,
        sum(case when result=2 then 1 else 0 end) as regCaseNum,
        sum(case when fo=1 then 1 else 0 end) as confirmeNum,
        sum(case when jc=1 then 1 else 0 end) as confirmeCancerNum,
        sum(case when (foT='02' or foT='04' or foT='05') and foN='02' and foM='01' then 1 else 0 end) as earlyDiagnosisNum
    from (
    </sql>
    <sql id="seScheduleNoCategoryList">
    select
          dhi.HOSPITAL_NAME as regorg,
          cancer.regorg as regorgCode,
          info.personcard  as personcard,
          cancer.check_result as result,
          fo.shifouquezhen as fo,
          fo.zhongliuTNM_T as foT,
          fo.zhongliuTNM_N as foN,
          fo.zhongliuTNM_M as foM,
    </sql>
    <!--查询页数-->
    <select id="pageCountSeAreaControl" resultType="java.lang.Integer"
            parameterType="com.wonders.health.tumor.statistics.vo.SeScheduleSearchVo">
        <choose>
            <when test="summary!=null and  summary!='' and summary!=5 ">
                select count(1)*2+1 from (
                select cancer.regorg ,
                dhi.HOSPITAL_NAME
            </when>
        </choose>
        <choose>
            <when test="summary==1">
                <include refid="pageSeAreaControlCRC"/>
            </when>
            <when test="summary==2">
                <include refid="pageSeAreaControlLUC"/>
            </when>
            <when test="summary==3">
                <include refid="pageSeAreaControlSC"/>
            </when>
            <when test="summary==4">
                <include refid="pageSeAreaControlLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary!=null and  summary!='' and summary!=5 ">
                group by dhi.HOSPITAL_NAME,cancer.regorg
                )
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg!=null and regorg!=''">
                select count(1)*2 from (
                SELECT
                regorg,
                regorgCode,
                <include refid="seScheduleNoCategoryHead"/>
            </when>
            <when test="summary ==5 and regorg==null and regorg==''">
                select count(1)+1 from (
                SELECT
                regorg,
                regorgCode,
                <include refid="seScheduleNoCategoryHead"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryCRCList"/>
                <include refid="pageSeAreaControlCRC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryLUCList"/>
                <include refid="pageSeAreaControlLUC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategorySCList"/>
                <include refid="pageSeAreaControlSC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryLICList"/>
                <include refid="pageSeAreaControlLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryTail"/>
                )
            </when>
        </choose>
    </select>

    <sql id="seScheduleList">
        count(*) as num,
        sum(case when risk.assessment_result is not null then 1 else 0 end) as summary,
        sum(case when risk.assessment_result=2 then 1 else 0 end) as regCaseNum,
        case when count(*)=0 then '0%' else round((sum(case when risk.assessment_result=2 then 1 else 0 end)/count(*)),4)*100||'%' end as regCaseRate,
        sum(case when (fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05') and fo.zhongliuTNM_N='02' and fo.zhongliuTNM_M='01' then 1 else 0 end) as earlyDiagnosisNum,
    </sql>
    <sql id="seScheduleCRCField">
        case when sum(case when fo.zhongliuleix is not null and fo.huojianjieguo='09' then 1 else 0 end)=0 then '0%' else round((sum(case when fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05' or fo.zhongliuTNM_N='02' or fo.zhongliuTNM_M='01' then 1 else 0 end)/sum(case when fo.zhongliuleix is not null or fo.huojianjieguo='09' then 1 else 0 end)),4)*100||'%' end as earlyDiagnosisRate,
        sum(case when changjing=1 then 1 else 0 end) as crcCheckNum,
        case when sum(case when risk.assessment_result=2 then 1 else 0 end)=0 then '0%' else round((sum(case when changjing=1 then 1 else 0 end)/sum(case when risk.assessment_result=2 then 1 else 0 end)),4)*100||'%' end as crcCheckRate,
        sum(case when fo.huojianjieguo='04' or fo.huojianjieguo='05' or fo.huojianjieguo='06' or fo.huojianjieguo='07' or fo.huojianjieguo='08' or fo.huojianjieguo='12' or fo.huojianjieguo='13' or fo.huojianjieguo='14' then 1 else 0 end) as crcLesionNum,
        sum(case when fo.bingbianchuli=1 then 1 else 0 end) as crcLesionRate,
        sum(case when fo.zhongliuleix is not null or fo.huojianjieguo='09' then 1 else 0 end) as crcCaseNum
    </sql>
    <sql id="seScheduleLUCField">
        case when sum(case when fo.shifouquezhen=1 then 1 else 0 end)=0 then '0%' else round((sum(case when fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05' or fo.zhongliuTNM_N='02' or fo.zhongliuTNM_M='01' then 1 else 0 end)/sum(case when fo.shifouquezhen=1 then 1 else 0 end)),4)*100||'%' end as earlyDiagnosisRate,
        sum(case when fo.shifouLDCT=1 then 1 else 0 end) as lucCheckNum,
        case when sum(case when fo.shifouLDCT=1 then 1 else 0 end)=0 then '0%' else round((sum(case when fo.shifouLDCT=1 then 1 else 0 end)/sum(case when risk.assessment_result=2 then 1 else 0 end)),4)*100||'%' end as lucCheckRate,
        sum(case when fo.shifouquezhen=1 then 1 else 0 end) as lucCaseNum
    </sql>
    <sql id="seScheduleSCField">
        case when sum(case when shifouquezhen=1 then 1 else 0 end)=0 then '0%' else round((sum(case when fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05'
        or fo.zhongliuTNM_N='02' or fo.zhongliuTNM_M='01' then 1 else 0 end)/ sum(case when shifouquezhen=1 then 1 else 0 end)),4)*100||'%' end as earlyDiagnosisRate,
        sum(case when shifouweijing=1 then 1 else 0 end) as scCheckNum,
        case when sum(case when risk.assessment_result=2 then 1 else 0 end)=0 then '0%' else round((sum(case when shifouweijing=1 then 1 else 0 end)/sum(case when risk.assessment_result=2 then 1 else 0 end)),4)*100||'%' end as scCheckRate,
        sum(case when shifouquezhen=1 then 1 else 0 end) as scCaseNum
    </sql>
    <sql id="seScheduleLICField">
        case when sum(case when shifouquezhen=1 then 1 else 0 end)=0 then '0%' else round((sum(case when fo.zhongliuTNM_T='02'or fo.zhongliuTNM_T='04' or fo.zhongliuTNM_T='05' or
        fo.zhongliuTNM_N='02' or fo.zhongliuTNM_M='01' then 1 else 0 end)/sum(case when shifouquezhen=1 then 1 else 0 end)),4)*100||'%' end as earlyDiagnosisRate,
        sum(case when shifouquezhen=1 then 1 else 0 end) as licCaseNum
    </sql>
    <sql id="seScheduleCRCTotal">
        case when sum(crcCaseNum)=0 then '0%' else round(sum(earlyDiagnosisNum)/sum(crcCaseNum),4)*100||'%' end as earlyDiagnosisRate,
        sum(crcCheckNum) as crcCheckNum,
        case when sum(regCaseNum)=0 then '0%' else round(sum(crcCheckNum)/sum(regCaseNum),4)*100||'%' end as crcCheckRate,
        sum(crcLesionNum) as crcLesionNum,
        sum(crcLesionRate) as crcLesionRate,
        sum(crcCaseNum) as crcCaseNum
    </sql>
    <sql id="seScheduleLUCTotal">
        case when sum(lucCaseNum)=0 then '0%' else round(sum(earlyDiagnosisNum)/sum(lucCaseNum),4)*100||'%' end as earlyDiagnosisRate,
        sum(lucCheckNum) as lucCheckNum,
        case when sum(regCaseNum)=0 then '0%' else round(sum(lucCheckNum)/sum(regCaseNum),4)*100||'%'end as lucCheckRate,
        sum(lucCaseNum) as lucCaseNum
    </sql>
    <sql id="seScheduleSCTotal">
        case when sum(scCaseNum)=0 then '0%' else round(sum(earlyDiagnosisNum)/sum(scCaseNum),4)*100||'%' end as earlyDiagnosisRate,
        sum(scCheckNum) as scCheckNum,
        case when sum(regCaseNum)=0 then '0%' else round(sum(scCheckNum)/sum(regCaseNum),4)*100||'%'end as lucCheckRate,
        sum(scCaseNum) as scCaseNum
    </sql>
    <sql id="seScheduleLICTotal">
        case when sum(licCaseNum)=0 then '0%' else round(sum(earlyDiagnosisNum)/sum(licCaseNum),4)*100||'%' end as earlyDiagnosisRate,
        sum(licCaseNum) as licCaseNum
    </sql>
    <select id="getSeAreaControl" parameterType="com.wonders.health.tumor.statistics.vo.SeScheduleSearchVo"
            resultType="com.wonders.health.tumor.statistics.vo.SeScheduleListVo">
        <choose>
            <when test="startRecord == 0">
                select * from (
            </when>
            <otherwise>
                select * from ( select row_.*, rownum rownum_ from (
            </otherwise>
        </choose>
        <choose>
            <when test="summary !=null and summary!='' and summary!=5">
                SELECT
                dhi.HOSPITAL_NAME as regorg,
                cancer.regorg as regorgCode,
                <include refid="seScheduleList"/>
            </when>
        </choose>
        <choose>
            <when test="summary == 1">
                <include refid="seScheduleCRCField"/>
                <include refid="pageSeAreaControlCRC"/>
            </when>
            <when test="summary == 2">
                <include refid="seScheduleLUCField"/>
                <include refid="pageSeAreaControlLUC"/>
            </when>
            <when test="summary == 3">
                <include refid="seScheduleSCField"/>
                <include refid="pageSeAreaControlSC"/>
            </when>
            <when test="summary == 4">
                <include refid="seScheduleLICField"/>
                <include refid="pageSeAreaControlLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary !=null and summary!='' and summary!=5">
                group by dhi.HOSPITAL_NAME,cancer.regorg
            </when>
        </choose>
        <choose>
            <when test="summary !=null and summary!='' and summary!=5 and regorg!=null and regorg!=''">
            union all
            select
                '合计' as regorg,
                regorgCode,
                sum(num) as num,
                sum(summary) as summary,
                sum(regCaseNum) as regCaseNum,
                case when sum(regCaseNum)=0 then '0%' else round(sum(regCaseNum)/sum(num),4)*100||'%' end  as regCaseRate,
                sum(earlyDiagnosisNum) as earlyDiagnosisNum,
            </when>
        </choose>
        <choose>
            <when test="summary == 1 and regorg!=null and regorg!=''">
                <include refid="seScheduleCRCTotal"/>
            </when>
            <when test="summary == 2 and regorg!=null and regorg!=''">
                <include refid="seScheduleLUCTotal"/>
            </when>
            <when test="summary == 3 and regorg!=null and regorg!=''">
                <include refid="seScheduleSCTotal"/>
            </when>
            <when test="summary == 4 and regorg!=null and regorg!=''">
                <include refid="seScheduleLICTotal"/>
            </when>
        </choose>
        <choose>
            <when test="summary !=null and summary!='' and summary!=5 and regorg!=null and regorg!=''">
                from(
                SELECT
                dhi.HOSPITAL_NAME as regorg,
                cancer.regorg as regorgCode,
                <include refid="seScheduleList"/>
            </when>
        </choose>
        <choose>
            <when test="summary == 1 and regorg!=null and regorg!=''">
                <include refid="seScheduleCRCField"/>
                <include refid="pageSeAreaControlCRC"/>
            </when>
            <when test="summary == 2 and regorg!=null and regorg!=''">
                <include refid="seScheduleLUCField"/>
                <include refid="pageSeAreaControlLUC"/>
            </when>
            <when test="summary == 3 and regorg!=null and regorg!=''">
                <include refid="seScheduleSCField"/>
                <include refid="pageSeAreaControlSC"/>
            </when>
            <when test="summary == 4 and regorg!=null and regorg!=''">
                <include refid="seScheduleLICField"/>
                <include refid="pageSeAreaControlLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary !=null and summary!='' and summary!=5 and regorg!=null and regorg!=''">
                group by dhi.HOSPITAL_NAME,cancer.regorg
                )
                group by regorg,regorgCode
            </when>
        </choose>
        <choose>
            <when test="summary !=null and summary!='' and summary!=5 and regorg==null and regorg==''">
                union all
                SELECT
                '合计' as regorg,
                '' as regorgCode,
                <include refid="seScheduleList"/>
            </when>
        </choose>
        <choose>
            <when test="summary == 1 and regorg==null and regorg==''">
                <include refid="seScheduleCRCField"/>
                <include refid="pageSeAreaControlCRC"/>
            </when>
            <when test="summary == 2 and regorg==null and regorg==''">
                <include refid="seScheduleLUCField"/>
                <include refid="pageSeAreaControlLUC"/>
            </when>
            <when test="summary == 3 and regorg==null and regorg==''">
                <include refid="seScheduleSCField"/>
                <include refid="pageSeAreaControlSC"/>
            </when>
            <when test="summary == 4 and regorg==null and regorg==''">
                <include refid="seScheduleLICField"/>
                <include refid="pageSeAreaControlLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary !=null and summary!='' and summary!=5 and regorg==null and regorg==''">
                group by dhi.HOSPITAL_NAME,cancer.regorg
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                SELECT
                regorg,
                regorgCode,
                <include refid="seScheduleNoCategoryHead"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryCRCList"/>
                <include refid="pageSeAreaControlCRC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryLUCList"/>
                <include refid="pageSeAreaControlLUC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategorySCList"/>
                <include refid="pageSeAreaControlSC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryLICList"/>
                <include refid="pageSeAreaControlLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5">
                <include refid="seScheduleNoCategoryTail"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg!=null and regorg!=''">
            union all
                SELECT
                '合计' as regorg,
                regorgCode,
                <include refid="seScheduleNoCategoryHead"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg!=null and regorg!=''">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryCRCList"/>
                <include refid="pageSeAreaControlCRC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg!=null and regorg!=''">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryLUCList"/>
                <include refid="pageSeAreaControlLUC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg!=null and regorg!=''">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategorySCList"/>
                <include refid="pageSeAreaControlSC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg!=null and regorg!=''">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryLICList"/>
                <include refid="pageSeAreaControlLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg!=null and regorg!=''">
                <include refid="seScheduleNoCategoryTail"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg==null and regorg==''">
                union all
                SELECT
                '合计' as regorg,
                '' as regorgCode,
                <include refid="seScheduleNoCategoryHead"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg==null and regorg==''">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryCRCList"/>
                <include refid="pageSeAreaControlCRC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg==null and regorg==''">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryLUCList"/>
                <include refid="pageSeAreaControlLUC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg==null and regorg==''">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategorySCList"/>
                <include refid="pageSeAreaControlSC"/>
                union all
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg==null and regorg==''">
                <include refid="seScheduleNoCategoryList"/>
                <include refid="seScheduleNoCategoryLICList"/>
                <include refid="pageSeAreaControlLIC"/>
            </when>
        </choose>
        <choose>
            <when test="summary ==5 and regorg==null and regorg==''">
                <include refid="seScheduleNoCategoryTail"/>
            </when>
        </choose>
        <choose>
            <when test="sortField != null and sortField != '' and sortOrder != '' and sortOrder != ''">
                ORDER BY ${sortField} ${sortOrder}
            </when>
        </choose>
        <choose>
            <when test="startRecord == 0">
                ) row_ where rownum &lt;= #{pageSize}
            </when>
            <otherwise>
                ) row_ where rownum &lt;= #{endRecord}) where rownum_ &gt; #{startRecord}
            </otherwise>
        </choose>
    </select>
    <select id="getBoxData" parameterType="com.wonders.health.tumor.statistics.vo.BoxData"
            resultType="com.wonders.health.tumor.statistics.vo.BoxData">
        select
            hospital_id code,
            hospital_name name
        from
              cancer_dic_hospital_info
        where del_flag=0
         <choose>
             <when test="code!=null and code!=''">
               and  hospital_id=#{code}
             </when>
             <otherwise>
               and  hospital_name=#{name}
             </otherwise>
         </choose>
    </select>
</mapper>